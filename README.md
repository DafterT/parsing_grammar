# Практическое задание 2

## О работе
- Курс: «Языки программирования», практическое задание №2 (вариант 2).
- Студент: Д. Л. Симоновский, группа P4119. 
- Руководитель: Ю. Д. Кореньков.
- Отчёт: `report/ЯП_2_лаба_Р4119_Симоновский.pdf`.

## Состав репозитория
- Грамматика tree-sitter: `grammar.js`, `src/grammar.json`, исходники парсера `src/parser.c`, готовая сборка `parser.dll`.
- Python-пакет для работы с грамматикой и графами: `python/` (`main.py`, `file_parser_to_graph.py`, `graph_parser.py`, `tree_parser.py`, `get_parse_tree.py`, `ast_generator.py`).
- Примеры входных программ и эталонных деревьев: `examples/*.txt`.
- Отчёт в `report/`.

## Требования
- Python 3.10+.
- Node.js + `tree-sitter` CLI (для сборки из грамматики): `npm i -g tree-sitter-cli`.
- Graphviz установлен в системе (для рендеринга `.svg`) и Python-пакет `graphviz`.

## Установка Python-зависимостей
Рекомендуется виртуальное окружение:
```
python -m venv .venv
.venv\Scripts\activate      # PowerShell/cmd
pip install -r requirements.txt
```

## Сборка парсера tree-sitter вручную
CLI-команды исполняются в папке `tree-sitter/`:
```
tree-sitter g       # сгенерировать src/parser.c
tree-sitter b       # собрать shared-библиотеку (Windows DLL)
```
Готовая библиотека появится как `parser.dll` в папке `tree-sitter/`.

## Запуск Python-утилиты
Скрипт `python/main.py` строит деревья разбора, CFG каждой функции и общий граф вызовов. Всегда указывается выходная директория, куда сохраняются:
- `tree/<имя_файла>.txt` — логическое дерево разбора;
- `graph/<имя_файла>_<имя_функции>.svg` — CFG;
- `call_graph.svg` — граф вызовов;
- `call_graph.errors.txt` — найденные ошибки/проблемы (создаётся при наличии ошибок).

Поддерживается единственный вариант запуска (готовая библиотека):
```
python python/main.py --lib tree-sitter/parser.dll --lang var2 examples/functions examples/empty out
```
- `--lib PATH` — путь к готовой `.dll/.so/.dylib`;
- `--lang NAME` — имя языка (функция `tree_sitter_<NAME>`). Если не указано, берётся из имени файла библиотеки.
- Далее: один или несколько входных файлов и выходная директория.
  
### Правила использования
- Позиционными остаются только входные файлы и выходная директория.
- Если входные программы содержат ошибки, они будут собраны в `call_graph.errors.txt`.

## Полезное
- Примеры входных файлов и ожидаемые деревья — в `examples/`.
- Отчёт по заданию: `report/ЯП_2_лаба_Р4119_Симоновский.pdf`.